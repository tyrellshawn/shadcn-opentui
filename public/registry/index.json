{
  "$schema": "https://ui.shadcn.com/schema/registry.json",
  "name": "@shadcn-opentui",
  "description": "Terminal components for shadcn/ui powered by OpenTUI",
  "homepage": "https://opentui.dev",
  "repository": "https://github.com/shadcn-opentui/terminal",
  "items": [
    {
      "name": "terminal",
      "type": "registry:ui",
      "title": "Terminal",
      "description": "A fully featured terminal emulator component with command history, autocomplete, and theming.",
      "dependencies": [
        "lucide-react"
      ],
      "registryDependencies": [],
      "files": [
        {
          "path": "components/ui/terminal.tsx",
          "content": "\"use client\"\r\n\r\nimport React, { useState, useRef, useCallback, useContext, createContext, useEffect, useLayoutEffect } from \"react\"\r\nimport { cn } from \"@/lib/utils\"\r\nimport type { CommandHandler } from \"@/lib/types\" // Declare or import CommandHandler\r\n\r\ninterface TerminalLine {\r\n  id: string\r\n  type: \"input\" | \"output\" | \"error\" | \"success\"\r\n  content: string\r\n  timestamp: Date\r\n}\r\n\r\ninterface TerminalCommand {\r\n  name: string\r\n  description: string\r\n  handler: (args: string[], context?: any) => Promise<void> | void\r\n  category?: \"system\" | \"ui\" | \"data\" | \"custom\"\r\n  requiresUI?: boolean\r\n}\r\n\r\ninterface TerminalProps extends React.HTMLAttributes<HTMLDivElement> {\r\n  prompt?: string\r\n  welcomeMessage?: string[]\r\n  commands?: Record<string, CommandHandler>\r\n  onCommand?: (command: string, args: string[]) => Promise<void> | void\r\n  maxLines?: number\r\n  showTimestamp?: boolean\r\n  variant?: \"default\" | \"compact\" | \"minimal\"\r\n  autoScroll?: boolean\r\n  smoothScroll?: boolean\r\n}\r\n\r\ninterface TerminalUIComponent {\r\n  id: string\r\n  type: \"form\" | \"menu\" | \"slider\" | \"progress\" | \"table\" | \"chart\"\r\n  props: Record<string, any>\r\n  active: boolean\r\n}\r\n\r\ninterface TerminalState {\r\n  mode: \"command\" | \"ui\" | \"form\"\r\n  activeComponent?: TerminalUIComponent\r\n  formData: Record<string, any>\r\n  menuSelection: number\r\n}\r\n\r\ninterface OpenTUIContext {\r\n  state: TerminalState\r\n  setState: React.Dispatch<React.SetStateAction<TerminalState>>\r\n  addUIComponent: (component: TerminalUIComponent) => void\r\n  removeUIComponent: (id: string) => void\r\n  updateFormData: (key: string, value: any) => void\r\n}\r\n\r\nconst OpenTUIContext = createContext<OpenTUIContext | null>(null)\r\n\r\nexport const useOpenTUI = () => {\r\n  const context = useContext(OpenTUIContext)\r\n  if (!context) {\r\n    throw new Error(\"useOpenTUI must be used within an OpenTUI provider\")\r\n  }\r\n  return context\r\n}\r\n\r\nconst createBuiltInCommands = (\r\n  addLine: (content: string, type?: TerminalLine[\"type\"]) => void,\r\n  clearLines: () => void,\r\n  commandHistory: string[],\r\n  opentuiContext?: OpenTUIContext,\r\n): TerminalCommand[] => [\r\n  {\r\n    name: \"clear\",\r\n    description: \"Clear the terminal screen\",\r\n    handler: () => clearLines(),\r\n  },\r\n  {\r\n    name: \"help\",\r\n    description: \"Show available commands\",\r\n    handler: () => {\r\n      addLine(\"Available commands:\", \"success\")\r\n      addLine(\"  clear      - Clear the terminal screen\")\r\n      addLine(\"  help       - Show this help message\")\r\n      addLine(\"  history    - Show command history\")\r\n      addLine(\"  date       - Show current date and time\")\r\n      addLine(\"  opentui    - Show OpenTUI information\")\r\n      addLine(\"  ui         - Enter UI mode for interactive components\")\r\n      addLine(\"  form       - Create an interactive form\")\r\n      addLine(\"  menu       - Create an interactive menu\")\r\n      addLine(\"  progress   - Show a progress bar\")\r\n      addLine(\"  ascii      - Generate ASCII art\")\r\n      addLine(\"  table      - Display data in table format\")\r\n    },\r\n  },\r\n  {\r\n    name: \"history\",\r\n    description: \"Show command history\",\r\n    handler: () => {\r\n      if (commandHistory.length === 0) {\r\n        addLine(\"No commands in history\")\r\n        return\r\n      }\r\n      addLine(\"Command history:\", \"success\")\r\n      commandHistory.forEach((cmd, index) => {\r\n        addLine(`  ${(index + 1).toString().padStart(3)} ${cmd}`)\r\n      })\r\n    },\r\n  },\r\n  {\r\n    name: \"date\",\r\n    description: \"Show current date and time\",\r\n    handler: () => {\r\n      addLine(new Date().toLocaleString(), \"success\")\r\n    },\r\n  },\r\n  {\r\n    name: \"opentui\",\r\n    description: \"Show OpenTUI information\",\r\n    category: \"system\",\r\n    handler: () => {\r\n      addLine(\"ðŸš€ OpenTUI Terminal Component\", \"success\")\r\n      addLine(\"Built with React and shadcn/ui\")\r\n      addLine(\"GitHub: https://github.com/sst/opentui\")\r\n      addLine(\"Type 'help' for available commands\")\r\n    },\r\n  },\r\n  {\r\n    name: \"ui\",\r\n    description: \"Enter UI mode for interactive components\",\r\n    category: \"ui\",\r\n    requiresUI: true,\r\n    handler: (args) => {\r\n      if (!opentuiContext) {\r\n        addLine(\"OpenTUI context not available\", \"error\")\r\n        return\r\n      }\r\n\r\n      const [componentType] = args\r\n      if (!componentType) {\r\n        addLine(\"Available UI components: form, menu, slider, progress\", \"success\")\r\n        addLine(\"Usage: ui <component-type>\")\r\n        return\r\n      }\r\n\r\n      opentuiContext.setState((prev) => ({\r\n        ...prev,\r\n        mode: \"ui\",\r\n        activeComponent: {\r\n          id: `ui-${Date.now()}`,\r\n          type: componentType as any,\r\n          props: {},\r\n          active: true,\r\n        },\r\n      }))\r\n\r\n      addLine(`Entering ${componentType} UI mode...`, \"success\")\r\n      addLine(\"Press ESC to return to command mode\")\r\n    },\r\n  },\r\n  {\r\n    name: \"form\",\r\n    description: \"Create an interactive form\",\r\n    category: \"ui\",\r\n    requiresUI: true,\r\n    handler: (args) => {\r\n      if (!opentuiContext) {\r\n        addLine(\"OpenTUI context not available\", \"error\")\r\n        return\r\n      }\r\n\r\n      const formFields = args.length > 0 ? args : [\"name\", \"email\"]\r\n\r\n      opentuiContext.setState((prev) => ({\r\n        ...prev,\r\n        mode: \"form\",\r\n        activeComponent: {\r\n          id: `form-${Date.now()}`,\r\n          type: \"form\",\r\n          props: { fields: formFields },\r\n          active: true,\r\n        },\r\n      }))\r\n\r\n      addLine(`Creating form with fields: ${formFields.join(\", \")}`, \"success\")\r\n      addLine(\"Use TAB to navigate, ENTER to submit, ESC to cancel\")\r\n    },\r\n  },\r\n  {\r\n    name: \"menu\",\r\n    description: \"Create an interactive menu\",\r\n    category: \"ui\",\r\n    requiresUI: true,\r\n    handler: (args) => {\r\n      if (!opentuiContext) {\r\n        addLine(\"OpenTUI context not available\", \"error\")\r\n        return\r\n      }\r\n\r\n      const menuItems = args.length > 0 ? args : [\"Option 1\", \"Option 2\", \"Option 3\"]\r\n\r\n      opentuiContext.setState((prev) => ({\r\n        ...prev,\r\n        mode: \"ui\",\r\n        activeComponent: {\r\n          id: `menu-${Date.now()}`,\r\n          type: \"menu\",\r\n          props: { items: menuItems },\r\n          active: true,\r\n        },\r\n        menuSelection: 0,\r\n      }))\r\n\r\n      addLine(`Creating menu with options: ${menuItems.join(\", \")}`, \"success\")\r\n      addLine(\"Use â†‘â†“ arrows to navigate, ENTER to select, ESC to cancel\")\r\n    },\r\n  },\r\n  {\r\n    name: \"progress\",\r\n    description: \"Show a progress bar\",\r\n    category: \"ui\",\r\n    handler: async (args) => {\r\n      const duration = Number.parseInt(args[0]) || 3000\r\n      const steps = 20\r\n      const stepDuration = duration / steps\r\n\r\n      addLine(\"Starting progress...\", \"success\")\r\n\r\n      for (let i = 0; i <= steps; i++) {\r\n        const percent = Math.round((i / steps) * 100)\r\n        const filled = \"â–ˆ\".repeat(i)\r\n        const empty = \"â–‘\".repeat(steps - i)\r\n        const bar = `[${filled}${empty}] ${percent}%`\r\n\r\n        addLine(`Progress: ${bar}`, \"output\")\r\n\r\n        if (i < steps) {\r\n          await new Promise((resolve) => setTimeout(resolve, stepDuration))\r\n        }\r\n      }\r\n\r\n      addLine(\"Progress complete!\", \"success\")\r\n    },\r\n  },\r\n  {\r\n    name: \"ascii\",\r\n    description: \"Generate ASCII art\",\r\n    category: \"ui\",\r\n    handler: (args) => {\r\n      const text = args.join(\" \") || \"OpenTUI\"\r\n      addLine(\"Generating ASCII art...\", \"success\")\r\n\r\n      // Simple ASCII art generator\r\n      const asciiArt = [\r\n        \"  ___                   _____ _   _ ___ \",\r\n        \" / _ \\\\ _ __   ___ _ __  |_   _| | | |_ _|\",\r\n        \"| | | | '_ \\\\ / _ \\\\ '_ \\\\   | | | | | || | \",\r\n        \"| |_| | |_) |  __/ | | |  | | | |_| || | \",\r\n        \" \\\\___/| .__/ \\\\___|_| |_|  |_|  \\\\___/|___|\",\r\n        \"      |_|                               \",\r\n      ]\r\n\r\n      asciiArt.forEach((line) => addLine(line, \"success\"))\r\n    },\r\n  },\r\n  {\r\n    name: \"table\",\r\n    description: \"Display data in table format\",\r\n    category: \"data\",\r\n    handler: (args) => {\r\n      const sampleData = [\r\n        [\"Name\", \"Age\", \"City\"],\r\n        [\"Alice\", \"25\", \"New York\"],\r\n        [\"Bob\", \"30\", \"San Francisco\"],\r\n        [\"Charlie\", \"35\", \"Chicago\"],\r\n      ]\r\n\r\n      addLine(\"Sample Data Table:\", \"success\")\r\n      sampleData.forEach((row, index) => {\r\n        const formattedRow = row.map((cell) => cell.padEnd(12)).join(\" | \")\r\n        addLine(index === 0 ? `| ${formattedRow} |` : `| ${formattedRow} |`, \"output\")\r\n        if (index === 0) {\r\n          addLine(`|${\"-\".repeat(formattedRow.length + 2)}|`, \"output\")\r\n        }\r\n      })\r\n    },\r\n  },\r\n]\r\n\r\nconst Terminal = React.forwardRef<HTMLDivElement, TerminalProps>(\r\n  (\r\n    {\r\n      className,\r\n      prompt = \"$\",\r\n      welcomeMessage = [\"Welcome to OpenTUI Terminal\", 'Type \"help\" to see available commands'],\r\n      commands = {},\r\n      onCommand,\r\n      maxLines = 1000,\r\n      showTimestamp = false,\r\n      variant = \"default\",\r\n      autoScroll = true,\r\n      smoothScroll = true,\r\n      ...props\r\n    },\r\n    ref,\r\n  ) => {\r\n    const [lines, setLines] = useState<TerminalLine[]>(() =>\r\n      welcomeMessage.map((msg, i) => ({\r\n        id: `welcome-${i}`,\r\n        type: \"output\" as const,\r\n        content: msg,\r\n        timestamp: new Date(),\r\n      })),\r\n    )\r\n\r\n    const [currentInput, setCurrentInput] = useState(\"\")\r\n    const [isProcessing, setIsProcessing] = useState(false)\r\n    const [commandHistory, setCommandHistory] = useState<string[]>([])\r\n    const [historyIndex, setHistoryIndex] = useState(-1)\r\n    const [cursorPosition, setCursorPosition] = useState(0)\r\n    const [userScrolledUp, setUserScrolledUp] = useState(false)\r\n\r\n    const inputRef = useRef<HTMLInputElement>(null)\r\n    const terminalRef = useRef<HTMLDivElement>(null)\r\n    const lineIdCounter = useRef(0)\r\n    const scrollAnimationRef = useRef<number | null>(null)\r\n    const lastScrollTimeRef = useRef<number>(0)\r\n    const rapidUpdateCountRef = useRef<number>(0)\r\n    const updateTimestampsRef = useRef<number[]>([])\r\n    const pendingScrollRef = useRef<number | null>(null)\r\n    const velocityRef = useRef<number>(0)\r\n    const isAnimatingRef = useRef<boolean>(false)\r\n    const targetScrollRef = useRef<number>(0)\r\n\r\n    const opentuiState = useState<TerminalState>({\r\n      mode: \"command\",\r\n      formData: {},\r\n      menuSelection: 0,\r\n    })\r\n\r\n    const opentuiContext: OpenTUIContext = {\r\n      state: opentuiState[0],\r\n      setState: opentuiState[1],\r\n      addUIComponent: (component) => {\r\n        opentuiState[1]((prev) => ({\r\n          ...prev,\r\n          activeComponent: component,\r\n        }))\r\n      },\r\n      removeUIComponent: (id) => {\r\n        opentuiState[1]((prev) => ({\r\n          ...prev,\r\n          activeComponent: prev.activeComponent?.id === id ? undefined : prev.activeComponent,\r\n        }))\r\n      },\r\n      updateFormData: (key, value) => {\r\n        opentuiState[1]((prev) => ({\r\n          ...prev,\r\n          formData: { ...prev.formData, [key]: value },\r\n        }))\r\n      },\r\n    }\r\n\r\n    const addLine = useCallback(\r\n      (content: string, type: TerminalLine[\"type\"] = \"output\") => {\r\n        const newLine: TerminalLine = {\r\n          id: `line-${lineIdCounter.current++}`,\r\n          type,\r\n          content,\r\n          timestamp: new Date(),\r\n        }\r\n\r\n        setLines((prev) => {\r\n          const newLines = [...prev, newLine]\r\n          return newLines.length > maxLines ? newLines.slice(-maxLines) : newLines\r\n        })\r\n      },\r\n      [maxLines],\r\n    )\r\n\r\n    const clearLines = useCallback(() => {\r\n      setLines([])\r\n    }, [])\r\n\r\n    const builtInCommands = createBuiltInCommands(addLine, clearLines, commandHistory, opentuiContext)\r\n    const allCommands = [...builtInCommands, ...Object.values(commands)]\r\n\r\n    const processCommand = useCallback(\r\n      async (input: string) => {\r\n        const [commandName, ...args] = input.trim().split(/\\s+/)\r\n        const command = allCommands.find((cmd) => cmd.name === commandName)\r\n\r\n        if (command) {\r\n          try {\r\n            await command.handler(args, opentuiContext)\r\n          } catch (error) {\r\n            addLine(\r\n              `Error executing ${commandName}: ${error instanceof Error ? error.message : \"Unknown error\"}`,\r\n              \"error\",\r\n            )\r\n          }\r\n        } else if (onCommand) {\r\n          try {\r\n            await onCommand(input, args)\r\n          } catch (error) {\r\n            addLine(`Error: ${error instanceof Error ? error.message : \"Unknown error\"}`, \"error\")\r\n          }\r\n        } else {\r\n          addLine(`Command not found: ${commandName}`, \"error\")\r\n          addLine(\"Type 'help' for available commands\")\r\n        }\r\n      },\r\n      [onCommand, addLine],\r\n    )\r\n\r\n    const handleCommand = async (command: string) => {\r\n      if (!command.trim()) return\r\n\r\n      setCommandHistory((prev) => [...prev, command])\r\n      setHistoryIndex(-1)\r\n\r\n      const inputLine = showTimestamp\r\n        ? `[${new Date().toLocaleTimeString()}] ${prompt} ${command}`\r\n        : `${prompt} ${command}`\r\n\r\n      addLine(inputLine, \"input\")\r\n      setCurrentInput(\"\")\r\n      setIsProcessing(true)\r\n\r\n      try {\r\n        await processCommand(command)\r\n      } finally {\r\n        setIsProcessing(false)\r\n        setTimeout(() => {\r\n          inputRef.current?.focus()\r\n        }, 0)\r\n      }\r\n    }\r\n\r\n    const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\r\n      if (opentuiState[0].mode === \"ui\" && opentuiState[0].activeComponent?.type === \"menu\") {\r\n        if (e.key === \"ArrowUp\") {\r\n          e.preventDefault()\r\n          opentuiState[1]((prev) => ({\r\n            ...prev,\r\n            menuSelection: Math.max(0, prev.menuSelection - 1),\r\n          }))\r\n          return\r\n        } else if (e.key === \"ArrowDown\") {\r\n          e.preventDefault()\r\n          const maxItems = opentuiState[0].activeComponent?.props.items?.length || 0\r\n          opentuiState[1]((prev) => ({\r\n            ...prev,\r\n            menuSelection: Math.min(maxItems - 1, prev.menuSelection + 1),\r\n          }))\r\n          return\r\n        } else if (e.key === \"Enter\") {\r\n          e.preventDefault()\r\n          const selectedItem = opentuiState[0].activeComponent?.props.items?.[opentuiState[0].menuSelection]\r\n          if (selectedItem) {\r\n            addLine(`Selected: ${selectedItem}`, \"success\")\r\n            opentuiState[1]((prev) => ({ ...prev, mode: \"command\", activeComponent: undefined }))\r\n          }\r\n          return\r\n        }\r\n      }\r\n\r\n      if (e.key === \"Escape\" && opentuiState[0].mode !== \"command\") {\r\n        e.preventDefault()\r\n        opentuiState[1]((prev) => ({ ...prev, mode: \"command\", activeComponent: undefined }))\r\n        addLine(\"Exited UI mode\", \"success\")\r\n        return\r\n      }\r\n\r\n      setTimeout(() => {\r\n        if (inputRef.current) {\r\n          setCursorPosition(inputRef.current.selectionStart || 0)\r\n        }\r\n      }, 0)\r\n\r\n      if (e.key === \"Enter\") {\r\n        e.preventDefault()\r\n        handleCommand(currentInput)\r\n      } else if (e.key === \"ArrowUp\") {\r\n        e.preventDefault()\r\n        if (commandHistory.length > 0) {\r\n          const newIndex = historyIndex === -1 ? commandHistory.length - 1 : Math.max(0, historyIndex - 1)\r\n          setHistoryIndex(newIndex)\r\n          setCurrentInput(commandHistory[newIndex])\r\n        }\r\n      } else if (e.key === \"ArrowDown\") {\r\n        e.preventDefault()\r\n        if (historyIndex !== -1) {\r\n          const newIndex = historyIndex + 1\r\n          if (newIndex >= commandHistory.length) {\r\n            setHistoryIndex(-1)\r\n            setCurrentInput(\"\")\r\n          } else {\r\n            setHistoryIndex(newIndex)\r\n            setCurrentInput(commandHistory[newIndex])\r\n          }\r\n        }\r\n      } else if (e.key === \"Tab\") {\r\n        e.preventDefault()\r\n        const commandNames = allCommands.map((cmd) => cmd.name)\r\n        const matches = commandNames.filter((cmd) => cmd.startsWith(currentInput))\r\n\r\n        if (matches.length === 1) {\r\n          setCurrentInput(matches[0])\r\n        } else if (matches.length > 1) {\r\n          addLine(`Available completions: ${matches.join(\", \")}`, \"success\")\r\n        }\r\n      } else if (e.key === \"l\" && e.ctrlKey) {\r\n        e.preventDefault()\r\n        clearLines()\r\n      }\r\n    }\r\n\r\n    const renderUIComponent = () => {\r\n      if (!opentuiState[0].activeComponent) return null\r\n\r\n      const { type, props } = opentuiState[0].activeComponent\r\n\r\n      switch (type) {\r\n        case \"menu\":\r\n          return (\r\n            <div className=\"border border-green-400/20 rounded p-2 mb-2 bg-black/50\">\r\n              <div className=\"text-green-400 text-xs mb-2\">MENU (Use â†‘â†“ arrows, ENTER to select)</div>\r\n              {props.items?.map((item: string, index: number) => (\r\n                <div\r\n                  key={index}\r\n                  className={cn(\r\n                    \"px-2 py-1 font-mono text-sm\",\r\n                    index === opentuiState[0].menuSelection ? \"bg-green-400 text-black\" : \"text-green-400\",\r\n                  )}\r\n                >\r\n                  {index === opentuiState[0].menuSelection ? \"â–º \" : \"  \"}\r\n                  {item}\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )\r\n        case \"form\":\r\n          return (\r\n            <div className=\"border border-green-400/20 rounded p-2 mb-2 bg-black/50\">\r\n              <div className=\"text-green-400 text-xs mb-2\">FORM (TAB to navigate, ENTER to submit)</div>\r\n              {props.fields?.map((field: string, index: number) => (\r\n                <div key={index} className=\"mb-2\">\r\n                  <label className=\"text-green-400 text-sm block mb-1\">{field}:</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    className=\"w-full bg-transparent border border-green-400/20 rounded px-2 py-1 text-green-400 font-mono text-sm focus:border-green-400 outline-none\"\r\n                    placeholder={`Enter ${field}`}\r\n                  />\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )\r\n        default:\r\n          return null\r\n      }\r\n    }\r\n\r\n    const getVariantStyles = () => {\r\n      switch (variant) {\r\n        case \"compact\":\r\n          return \"p-2 text-xs\"\r\n        case \"minimal\":\r\n          return \"p-3 border-0 shadow-none\"\r\n        default:\r\n          return \"p-4 text-sm shadow-2xl shadow-green-400/10\"\r\n      }\r\n    }\r\n\r\n    const getHeightClass = () => {\r\n      switch (variant) {\r\n        case \"compact\":\r\n          return \"h-64\"\r\n        case \"minimal\":\r\n          return \"h-48\"\r\n        default:\r\n          return \"h-96\"\r\n      }\r\n    }\r\n\r\n    const scrollToBottom = useCallback(\r\n      (forceInstant = false) => {\r\n        if (!terminalRef.current || !autoScroll || userScrolledUp) return\r\n\r\n        const now = performance.now()\r\n        const element = terminalRef.current\r\n        const targetScrollTop = element.scrollHeight - element.clientHeight\r\n\r\n        // Track update timestamps for data rate calculation\r\n        updateTimestampsRef.current.push(now)\r\n        // Keep only last 10 timestamps for rate calculation\r\n        if (updateTimestampsRef.current.length > 10) {\r\n          updateTimestampsRef.current.shift()\r\n        }\r\n\r\n        // Calculate data rate (updates per second)\r\n        const timestamps = updateTimestampsRef.current\r\n        let dataRate = 0\r\n        if (timestamps.length >= 2) {\r\n          const timeSpan = timestamps[timestamps.length - 1] - timestamps[0]\r\n          dataRate = timeSpan > 0 ? (timestamps.length - 1) / (timeSpan / 1000) : 0\r\n        }\r\n\r\n        // Store target for animation\r\n        targetScrollRef.current = targetScrollTop\r\n\r\n        // Determine scroll strategy based on data rate\r\n        const isRapidUpdate = dataRate > 10 // More than 10 updates/second\r\n        const isVeryRapidUpdate = dataRate > 30 // More than 30 updates/second\r\n\r\n        // For instant scroll scenarios\r\n        if (forceInstant || !smoothScroll || isVeryRapidUpdate) {\r\n          // Cancel any pending animation\r\n          if (scrollAnimationRef.current) {\r\n            cancelAnimationFrame(scrollAnimationRef.current)\r\n            scrollAnimationRef.current = null\r\n          }\r\n          if (pendingScrollRef.current) {\r\n            clearTimeout(pendingScrollRef.current)\r\n            pendingScrollRef.current = null\r\n          }\r\n          isAnimatingRef.current = false\r\n          element.scrollTop = targetScrollTop\r\n          return\r\n        }\r\n\r\n        // For rapid updates, batch them with debounce to hide intermediary states\r\n        if (isRapidUpdate) {\r\n          if (pendingScrollRef.current) {\r\n            clearTimeout(pendingScrollRef.current)\r\n          }\r\n\r\n          // Batch updates - only animate to final position after brief pause\r\n          pendingScrollRef.current = window.setTimeout(() => {\r\n            pendingScrollRef.current = null\r\n            performSmoothScroll(element, targetScrollRef.current, dataRate)\r\n          }, 16) as unknown as number // ~1 frame delay for batching\r\n\r\n          return\r\n        }\r\n\r\n        // For normal updates, animate immediately\r\n        performSmoothScroll(element, targetScrollTop, dataRate)\r\n      },\r\n      [autoScroll, userScrolledUp, smoothScroll],\r\n    )\r\n\r\n    const performSmoothScroll = useCallback((element: HTMLDivElement, targetScrollTop: number, dataRate: number) => {\r\n      // Cancel existing animation\r\n      if (scrollAnimationRef.current) {\r\n        cancelAnimationFrame(scrollAnimationRef.current)\r\n        scrollAnimationRef.current = null\r\n      }\r\n\r\n      const currentScrollTop = element.scrollTop\r\n      const distance = targetScrollTop - currentScrollTop\r\n\r\n      // Skip animation for tiny distances\r\n      if (Math.abs(distance) < 2) {\r\n        element.scrollTop = targetScrollTop\r\n        return\r\n      }\r\n\r\n      // Adaptive duration based on data rate and distance\r\n      // Faster data rate = shorter duration for responsiveness\r\n      // Larger distance = slightly longer duration for smoothness\r\n      const baseSpeed = Math.max(0.1, 1 - dataRate / 50) // 0.1 to 1.0\r\n      const distanceFactor = Math.min(1.5, 1 + Math.abs(distance) / 500)\r\n      const duration = Math.max(50, Math.min(200, 120 * baseSpeed * distanceFactor))\r\n\r\n      const startTime = performance.now()\r\n      const startScrollTop = currentScrollTop\r\n      isAnimatingRef.current = true\r\n\r\n      // Calculate initial velocity for momentum\r\n      const initialVelocity = velocityRef.current\r\n\r\n      const animateScroll = (currentTime: number) => {\r\n        if (!isAnimatingRef.current) return\r\n\r\n        const elapsed = currentTime - startTime\r\n        const progress = Math.min(elapsed / duration, 1)\r\n\r\n        // Spring-inspired easing: fast start, smooth deceleration\r\n        // Uses critically damped spring formula approximation\r\n        const springProgress = 1 - Math.pow(1 - progress, 3) * (1 + 3 * progress)\r\n\r\n        // Add momentum influence for natural feel\r\n        const momentumFactor =\r\n          Math.max(0, 1 - progress * 2) * Math.sign(initialVelocity) * Math.min(Math.abs(initialVelocity) * 0.01, 10)\r\n\r\n        const newScrollTop = startScrollTop + distance * springProgress + momentumFactor\r\n\r\n        // Check if target changed during animation (new content added)\r\n        const currentTarget = element.scrollHeight - element.clientHeight\r\n        if (Math.abs(currentTarget - targetScrollTop) > 50) {\r\n          // Target changed significantly, update and continue\r\n          targetScrollRef.current = currentTarget\r\n          element.scrollTop = currentTarget\r\n          isAnimatingRef.current = false\r\n          scrollAnimationRef.current = null\r\n          return\r\n        }\r\n\r\n        element.scrollTop = newScrollTop\r\n\r\n        // Track velocity for momentum\r\n        velocityRef.current = (distance / duration) * (1 - progress)\r\n\r\n        if (progress < 1) {\r\n          scrollAnimationRef.current = requestAnimationFrame(animateScroll)\r\n        } else {\r\n          // Ensure we end exactly at target\r\n          element.scrollTop = targetScrollTop\r\n          isAnimatingRef.current = false\r\n          scrollAnimationRef.current = null\r\n          velocityRef.current = 0\r\n        }\r\n      }\r\n\r\n      scrollAnimationRef.current = requestAnimationFrame(animateScroll)\r\n    }, [])\r\n\r\n    useLayoutEffect(() => {\r\n      scrollToBottom()\r\n    }, [lines, scrollToBottom])\r\n\r\n    const handleScroll = useCallback(() => {\r\n      if (!terminalRef.current) return\r\n\r\n      const element = terminalRef.current\r\n      const isAtBottom = element.scrollHeight - element.scrollTop - element.clientHeight < 50\r\n\r\n      setUserScrolledUp(!isAtBottom)\r\n    }, [])\r\n\r\n    const handleSubmit = useCallback(async () => {\r\n      if (!currentInput.trim() || isProcessing) return\r\n\r\n      setUserScrolledUp(false)\r\n\r\n      const input = currentInput.trim()\r\n      setCurrentInput(\"\")\r\n      setIsProcessing(true)\r\n\r\n      addLine(`${prompt} ${input}`, \"input\")\r\n\r\n      setCommandHistory((prev) => {\r\n        const newHistory = [...prev, input]\r\n        return newHistory.slice(-100)\r\n      })\r\n      setHistoryIndex(-1)\r\n\r\n      await processCommand(input)\r\n      setIsProcessing(false)\r\n    }, [currentInput, isProcessing, prompt, addLine, processCommand])\r\n\r\n    useEffect(() => {\r\n      return () => {\r\n        if (scrollAnimationRef.current) {\r\n          cancelAnimationFrame(scrollAnimationRef.current)\r\n        }\r\n        if (pendingScrollRef.current) {\r\n          clearTimeout(pendingScrollRef.current)\r\n        }\r\n      }\r\n    }, [])\r\n\r\n    return (\r\n      <OpenTUIContext.Provider value={opentuiContext}>\r\n        <div\r\n          ref={ref}\r\n          className={cn(\r\n            \"bg-black text-green-400 font-mono rounded-lg border border-border overflow-hidden\",\r\n            getVariantStyles(),\r\n            className,\r\n          )}\r\n          onClick={(e) => {\r\n            const target = e.target as HTMLElement\r\n            const isFormInput =\r\n              target.tagName === \"INPUT\" ||\r\n              target.tagName === \"TEXTAREA\" ||\r\n              target.tagName === \"SELECT\" ||\r\n              target.closest(\"input, textarea, select\")\r\n\r\n            if (isFormInput) {\r\n              return\r\n            }\r\n\r\n            if (inputRef.current && !isProcessing && opentuiState[0].mode === \"command\") {\r\n              inputRef.current.focus()\r\n            }\r\n          }}\r\n          {...props}\r\n        >\r\n          {variant !== \"minimal\" && (\r\n            <div className=\"flex items-center justify-between mb-2 pb-2 border-b border-green-400/20\">\r\n              <div className=\"text-green-400 text-xs font-semibold\">\r\n                OpenTUI Terminal {opentuiState[0].mode !== \"command\" && `- ${opentuiState[0].mode.toUpperCase()} MODE`}\r\n              </div>\r\n              <div className=\"text-green-400/60 text-xs\">Ctrl+L to clear</div>\r\n            </div>\r\n          )}\r\n\r\n          <div\r\n            ref={terminalRef}\r\n            className={cn(\"overflow-y-auto terminal-scrollbar\", getHeightClass())}\r\n            onScroll={handleScroll}\r\n            onClick={(e) => {\r\n              const target = e.target as HTMLElement\r\n              const isFormInput =\r\n                target.tagName === \"INPUT\" ||\r\n                target.tagName === \"TEXTAREA\" ||\r\n                target.tagName === \"SELECT\" ||\r\n                target.closest(\"input, textarea, select\")\r\n\r\n              if (isFormInput) {\r\n                e.stopPropagation()\r\n                return\r\n              }\r\n\r\n              e.stopPropagation()\r\n              if (inputRef.current && !isProcessing && opentuiState[0].mode === \"command\") {\r\n                inputRef.current.focus()\r\n              }\r\n            }}\r\n          >\r\n            {lines.map((line) => (\r\n              <div\r\n                key={line.id}\r\n                className={cn(\r\n                  \"whitespace-pre-wrap break-words leading-relaxed mb-1\",\r\n                  line.type === \"input\" && \"text-white font-semibold\",\r\n                  line.type === \"error\" && \"text-red-400\",\r\n                  line.type === \"success\" && \"text-emerald-400\",\r\n                  line.type === \"output\" && \"text-green-400\",\r\n                )}\r\n              >\r\n                {line.content}\r\n              </div>\r\n            ))}\r\n\r\n            {renderUIComponent()}\r\n\r\n            <div className=\"flex items-center text-white mt-1 relative\">\r\n              <span className=\"text-green-400 mr-2 font-bold shrink-0\">{prompt}</span>\r\n              <div className=\"flex-1 relative\">\r\n                <input\r\n                  ref={inputRef}\r\n                  type=\"text\"\r\n                  value={currentInput}\r\n                  onChange={(e) => {\r\n                    setCurrentInput(e.target.value)\r\n                    setCursorPosition(e.target.selectionStart || 0)\r\n                  }}\r\n                  onKeyDown={handleKeyDown}\r\n                  onSelect={() => {\r\n                    if (inputRef.current) {\r\n                      setCursorPosition(inputRef.current.selectionStart || 0)\r\n                    }\r\n                  }}\r\n                  onClick={() => {\r\n                    if (inputRef.current) {\r\n                      setCursorPosition(inputRef.current.selectionStart || 0)\r\n                    }\r\n                  }}\r\n                  disabled={isProcessing}\r\n                  className=\"w-full bg-transparent border-none outline-none text-white font-mono caret-transparent\"\r\n                  autoComplete=\"off\"\r\n                  spellCheck={false}\r\n                  placeholder={\r\n                    isProcessing\r\n                      ? \"Processing...\"\r\n                      : opentuiState[0].mode !== \"command\"\r\n                        ? `${opentuiState[0].mode.toUpperCase()} mode - ESC to exit`\r\n                        : \"Type a command...\"\r\n                  }\r\n                />\r\n                <div\r\n                  className=\"absolute top-0 w-2 h-5 bg-green-400 pointer-events-none\"\r\n                  style={{\r\n                    left: `${cursorPosition * 0.6}em`,\r\n                    animation: \"blink 1s infinite\",\r\n                  }}\r\n                />\r\n              </div>\r\n              {isProcessing && <span className=\"ml-2 text-yellow-400 animate-pulse\">âš¡</span>}\r\n            </div>\r\n          </div>\r\n\r\n          <style jsx>{`\r\n            @keyframes blink {\r\n              0%, 50% { opacity: 1; }\r\n              51%, 100% { opacity: 0; }\r\n            }\r\n\r\n            .terminal-scrollbar {\r\n              scrollbar-width: thin;\r\n              scrollbar-color: green-400/50 transparent;\r\n            }\r\n\r\n            .terminal-scrollbar::-webkit-scrollbar {\r\n              width: 0.5em;\r\n            }\r\n\r\n            .terminal-scrollbar::-webkit-scrollbar-track {\r\n              background: transparent;\r\n            }\r\n\r\n            .terminal-scrollbar::-webkit-scrollbar-thumb {\r\n              background-color: green-400/50;\r\n              border-radius: 0.25em;\r\n            }\r\n\r\n            .terminal-scrollbar::-webkit-scrollbar-thumb:hover {\r\n              background-color: green-400;\r\n            }\r\n          `}</style>\r\n        </div>\r\n      </OpenTUIContext.Provider>\r\n    )\r\n  },\r\n)\r\n\r\nTerminal.displayName = \"Terminal\"\r\n\r\nexport { Terminal }\r\nexport type { TerminalProps, TerminalLine, TerminalCommand, OpenTUIContext }\r\n",
          "type": "registry:ui"
        }
      ]
    },
    {
      "name": "terminal-controls",
      "type": "registry:ui",
      "title": "Terminal Controls",
      "description": "Window control buttons (close, minimize, maximize) for the terminal.",
      "dependencies": [],
      "registryDependencies": [
        "terminal"
      ],
      "files": [
        {
          "path": "components/ui/terminal-controls.tsx",
          "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { TerminalSlider } from \"./terminal-slider\"\nimport { Button } from \"./button\"\nimport { cn } from \"@/lib/utils\"\n\ninterface TerminalControlsProps {\n  className?: string\n  onCommand?: (command: string) => void\n}\n\nfunction TerminalControls({ className, onCommand }: TerminalControlsProps) {\n  const [volume, setVolume] = React.useState([75])\n  const [brightness, setBrightness] = React.useState([50])\n  const [speed, setSpeed] = React.useState([25])\n\n  const handleControlCommand = (type: string, value: number) => {\n    const command = `set ${type} ${value}`\n    onCommand?.(command)\n  }\n\n  return (\n    <div className={cn(\"space-y-4 p-4 border border-green-400/20 rounded bg-black/50\", className)}>\n      <div className=\"text-green-400 font-mono text-sm border-b border-green-400/20 pb-2\">TERMINAL CONTROLS</div>\n\n      <TerminalSlider\n        label=\"Volume\"\n        value={volume}\n        onValueChange={(val) => {\n          setVolume(val)\n          handleControlCommand(\"volume\", val[0])\n        }}\n        unit=\"%\"\n        max={100}\n      />\n\n      <TerminalSlider\n        label=\"Brightness\"\n        value={brightness}\n        onValueChange={(val) => {\n          setBrightness(val)\n          handleControlCommand(\"brightness\", val[0])\n        }}\n        unit=\"%\"\n        max={100}\n        ascii\n        width={15}\n      />\n\n      <TerminalSlider\n        label=\"Processing Speed\"\n        value={speed}\n        onValueChange={(val) => {\n          setSpeed(val)\n          handleControlCommand(\"speed\", val[0])\n        }}\n        unit=\" ops/s\"\n        max={100}\n      />\n\n      <div className=\"flex gap-2 pt-2\">\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          className=\"font-mono text-xs border-green-400/20 text-green-400 hover:bg-green-400/10 bg-transparent\"\n          onClick={() => onCommand?.(\"reset controls\")}\n        >\n          RESET\n        </Button>\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          className=\"font-mono text-xs border-green-400/20 text-green-400 hover:bg-green-400/10 bg-transparent\"\n          onClick={() => onCommand?.(\"save config\")}\n        >\n          SAVE\n        </Button>\n      </div>\n    </div>\n  )\n}\n\nexport { TerminalControls }\n",
          "type": "registry:ui"
        }
      ]
    },
    {
      "name": "terminal-slider",
      "type": "registry:ui",
      "title": "Terminal Slider",
      "description": "An ASCII slider component for terminal interfaces.",
      "dependencies": [],
      "registryDependencies": [
        "terminal"
      ],
      "files": [
        {
          "path": "components/ui/terminal-slider.tsx",
          "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\nimport { cn } from \"@/lib/utils\"\n\ninterface TerminalSliderProps extends React.ComponentProps<typeof SliderPrimitive.Root> {\n  label?: string\n  showValue?: boolean\n  unit?: string\n  ascii?: boolean\n  width?: number\n}\n\nfunction TerminalSlider({\n  className,\n  label,\n  showValue = true,\n  unit = \"\",\n  ascii = false,\n  width = 20,\n  value,\n  defaultValue,\n  min = 0,\n  max = 100,\n  ...props\n}: TerminalSliderProps) {\n  const [internalValue, setInternalValue] = React.useState(value || defaultValue || [min])\n\n  const currentValue = value || internalValue\n  const displayValue = Array.isArray(currentValue) ? currentValue[0] : currentValue\n\n  const createAsciiBar = (val: number, total: number, barWidth: number) => {\n    const filled = Math.round((val / total) * barWidth)\n    const empty = barWidth - filled\n    return \"â–ˆ\".repeat(filled) + \"â–‘\".repeat(empty)\n  }\n\n  const handleValueChange = (newValue: number[]) => {\n    setInternalValue(newValue)\n    props.onValueChange?.(newValue)\n  }\n\n  return (\n    <div className={cn(\"space-y-2 font-mono\", className)}>\n      {label && (\n        <div className=\"flex items-center justify-between text-sm\">\n          <span className=\"text-green-400\">{label}</span>\n          {showValue && (\n            <span className=\"text-muted-foreground\">\n              {displayValue}\n              {unit}\n            </span>\n          )}\n        </div>\n      )}\n\n      {ascii ? (\n        <div className=\"space-y-1\">\n          <div className=\"text-xs text-green-400 font-mono\">\n            [{createAsciiBar(displayValue, max, width)}] {displayValue}\n            {unit}\n          </div>\n          <SliderPrimitive.Root\n            value={currentValue}\n            defaultValue={defaultValue}\n            min={min}\n            max={max}\n            onValueChange={handleValueChange}\n            className=\"relative flex w-full touch-none items-center select-none opacity-0 absolute inset-0\"\n            {...props}\n          >\n            <SliderPrimitive.Track className=\"bg-transparent relative grow overflow-hidden h-4 w-full\">\n              <SliderPrimitive.Range className=\"bg-transparent absolute h-full\" />\n            </SliderPrimitive.Track>\n            <SliderPrimitive.Thumb className=\"bg-transparent border-transparent block size-4 shrink-0\" />\n          </SliderPrimitive.Root>\n        </div>\n      ) : (\n        <SliderPrimitive.Root\n          value={currentValue}\n          defaultValue={defaultValue}\n          min={min}\n          max={max}\n          onValueChange={handleValueChange}\n          className={cn(\"relative flex w-full touch-none items-center select-none\", \"data-[disabled]:opacity-50\")}\n          {...props}\n        >\n          <SliderPrimitive.Track className=\"bg-muted/30 border border-green-400/20 relative grow overflow-hidden rounded-none h-2 w-full\">\n            <SliderPrimitive.Range className=\"bg-green-400 absolute h-full\" />\n          </SliderPrimitive.Track>\n          <SliderPrimitive.Thumb className=\"border-green-400 bg-green-400 ring-green-400/50 block size-3 shrink-0 rounded-none border shadow-sm transition-[color,box-shadow] hover:ring-2 focus-visible:ring-2 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50\" />\n        </SliderPrimitive.Root>\n      )}\n\n      <div className=\"flex justify-between text-xs text-muted-foreground font-mono\">\n        <span>\n          {min}\n          {unit}\n        </span>\n        <span>\n          {max}\n          {unit}\n        </span>\n      </div>\n    </div>\n  )\n}\n\nexport { TerminalSlider }\n",
          "type": "registry:ui"
        }
      ]
    }
  ]
}
