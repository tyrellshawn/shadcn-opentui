{
  "name": "cli-ink-adapter",
  "type": "registry:lib",
  "title": "Ink v6 Adapter",
  "description": "Adapter for Ink v6.6.0+ CLI components. Bridges Ink apps to OpenTUI terminal.",
  "dependencies": [
    "ink@^6.6.0"
  ],
  "registryDependencies": [
    "cli-plugin-types",
    "cli-base-adapter",
    "cli-version-negotiator"
  ],
  "files": [
    {
      "path": "lib/opentui/plugins/cli/adapters/ink-adapter.ts",
      "content": "// Ink v6.6.0+ Adapter for CLI Plugin Framework\n// Bridges Ink CLI components to OpenTUI terminal\n\nimport type {\n  CLILibrary,\n  VersionRange,\n  CLIFeature,\n  CLITerminalBridge,\n  CLIRenderInstance,\n} from \"../types\"\nimport { BaseCLIAdapter, BaseRenderInstance, generateId } from \"./base-adapter\"\n\n/**\n * Configuration options for the Ink adapter\n */\nexport interface InkAdapterOptions {\n  /** Enable debug mode */\n  debug?: boolean\n  /** Render output to terminal bridge instead of stdout */\n  useTerminalBridge?: boolean\n  /** Patch interval for updates (ms) */\n  patchInterval?: number\n}\n\n/**\n * Default Ink adapter options\n */\nconst DEFAULT_OPTIONS: Required<InkAdapterOptions> = {\n  debug: false,\n  useTerminalBridge: true,\n  patchInterval: 16, // ~60fps\n}\n\n/**\n * Ink v6 supported features by version\n */\nconst INK_FEATURES: Record<string, CLIFeature[]> = {\n  \"6.6.0\": [\n    \"useInput\",\n    \"useStdin\",\n    \"useStdout\",\n    \"useFocus\",\n    \"flexbox\",\n    \"colors16\",\n    \"colors256\",\n    \"unicode\",\n    \"boxDrawing\",\n  ],\n  \"6.7.0\": [\n    \"useInput\",\n    \"useStdin\",\n    \"useStdout\",\n    \"useFocus\",\n    \"useFocusManager\",\n    \"measureElement\",\n    \"flexbox\",\n    \"colors16\",\n    \"colors256\",\n    \"trueColor\",\n    \"unicode\",\n    \"boxDrawing\",\n  ],\n  \"6.8.0\": [\n    \"useInput\",\n    \"useStdin\",\n    \"useStdout\",\n    \"useFocus\",\n    \"useFocusManager\",\n    \"measureElement\",\n    \"staticOutput\",\n    \"flexbox\",\n    \"colors16\",\n    \"colors256\",\n    \"trueColor\",\n    \"unicode\",\n    \"mouse\",\n    \"boxDrawing\",\n  ],\n}\n\n/**\n * Ink render instance that bridges to OpenTUI\n */\nclass InkRenderInstance extends BaseRenderInstance {\n  private component: React.ComponentType<unknown>\n  private props: Record<string, unknown>\n  private bridge: CLITerminalBridge\n  private renderCallback: (() => void) | null = null\n  private outputBuffer: string[] = []\n  private options: Required<InkAdapterOptions>\n\n  constructor(\n    id: string,\n    component: React.ComponentType<unknown>,\n    props: Record<string, unknown>,\n    bridge: CLITerminalBridge,\n    options: Required<InkAdapterOptions>\n  ) {\n    super(id)\n    this.component = component\n    this.props = props\n    this.bridge = bridge\n    this.options = options\n    \n    // Start rendering\n    this.startRender()\n  }\n\n  /**\n   * Start the render loop\n   */\n  private startRender(): void {\n    // In a full implementation, this would integrate with Ink's render function\n    // For now, we simulate the render cycle with a callback pattern\n    this.render()\n  }\n\n  /**\n   * Perform a render cycle\n   */\n  private render(): void {\n    if (!this._isActive || this._isPaused) return\n\n    try {\n      // In a real implementation, this would call Ink's render function\n      // and capture the output to send to the terminal bridge\n      \n      // For demonstration, we'll emit a placeholder that shows the component is running\n      if (this.options.debug) {\n        this.bridge.writeLine(`[Ink] Rendering component: ${this.component.name || \"Anonymous\"}`, \"system\")\n      }\n    } catch (error) {\n      if (this.options.debug) {\n        this.bridge.writeLine(`[Ink] Render error: ${error}`, \"error\")\n      }\n    }\n  }\n\n  rerender(props?: Record<string, unknown>): void {\n    if (!this._isActive) return\n    if (props) {\n      this.props = { ...this.props, ...props }\n    }\n    this.render()\n  }\n\n  clear(): void {\n    this.outputBuffer = []\n    this.bridge.clear()\n  }\n\n  protected doUnmount(): void {\n    this.renderCallback = null\n    this.outputBuffer = []\n  }\n\n  protected doPause(): void {\n    // Stop render updates but keep state\n  }\n\n  protected doResume(): void {\n    // Resume render updates\n    this.render()\n  }\n\n  /**\n   * Write output to terminal bridge\n   */\n  writeOutput(content: string): void {\n    this.outputBuffer.push(content)\n    this.bridge.writeLine(content)\n  }\n\n  /**\n   * Get current props\n   */\n  getProps(): Record<string, unknown> {\n    return { ...this.props }\n  }\n\n  /**\n   * Set exit code and trigger exit\n   */\n  exit(code: number = 0): void {\n    this.setExitCode(code)\n    this.unmount()\n  }\n}\n\n/**\n * Ink v6.6.0+ Adapter\n * \n * This adapter provides integration between Ink CLI components and OpenTUI.\n * It supports Ink version 6.6.0 and above, with feature detection for\n * version-specific capabilities.\n */\nexport class InkAdapter extends BaseCLIAdapter {\n  readonly library: CLILibrary = \"ink\"\n  readonly adapterVersion = \"1.0.0\"\n  readonly supportedVersions: VersionRange = \">=6.6.0 <7.0.0\"\n\n  private options: Required<InkAdapterOptions>\n  private currentLibraryVersion = \"6.6.0\" // Default to minimum supported\n\n  constructor(options: InkAdapterOptions = {}) {\n    super()\n    this.options = { ...DEFAULT_OPTIONS, ...options }\n  }\n\n  /**\n   * Set the target Ink library version\n   * This allows apps to specify which version's features they need\n   */\n  setTargetVersion(version: string): void {\n    this.currentLibraryVersion = version\n  }\n\n  protected async doInitialize(): Promise<void> {\n    // In a full implementation, this would:\n    // 1. Dynamically import the Ink package\n    // 2. Verify the installed version\n    // 3. Set up any global Ink configuration\n    \n    if (this.options.debug) {\n      console.log(`[InkAdapter] Initialized for Ink ${this.supportedVersions}`)\n    }\n  }\n\n  protected async doDestroy(): Promise<void> {\n    // Cleanup any Ink-specific resources\n    if (this.options.debug) {\n      console.log(\"[InkAdapter] Destroyed\")\n    }\n  }\n\n  protected doCreateRenderInstance(\n    id: string,\n    component: React.ComponentType<unknown>,\n    props: Record<string, unknown>,\n    bridge: CLITerminalBridge\n  ): CLIRenderInstance {\n    return new InkRenderInstance(id, component, props, bridge, this.options)\n  }\n\n  protected getAdapterLibraryVersion(): string {\n    return this.currentLibraryVersion\n  }\n\n  protected getSupportedFeatures(): CLIFeature[] {\n    // Get features for current library version\n    const version = this.currentLibraryVersion\n    \n    // Find the best matching feature set\n    const versionKeys = Object.keys(INK_FEATURES).sort()\n    let features: CLIFeature[] = []\n    \n    for (const v of versionKeys) {\n      if (this.compareVersions(version, v) >= 0) {\n        features = INK_FEATURES[v]\n      }\n    }\n    \n    return features\n  }\n\n  /**\n   * Compare two version strings\n   */\n  private compareVersions(a: string, b: string): number {\n    const partsA = a.split(\".\").map(Number)\n    const partsB = b.split(\".\").map(Number)\n    \n    for (let i = 0; i < Math.max(partsA.length, partsB.length); i++) {\n      const partA = partsA[i] || 0\n      const partB = partsB[i] || 0\n      if (partA !== partB) {\n        return partA - partB\n      }\n    }\n    \n    return 0\n  }\n\n  /**\n   * Transform props for version compatibility\n   * Handles API changes between Ink versions\n   */\n  transformProps(props: Record<string, unknown>, targetVersion: string): Record<string, unknown> {\n    const transformed = { ...props }\n    \n    // Example: Handle API changes between versions\n    // In a real implementation, this would handle breaking changes\n    \n    // 6.6.0 -> 6.7.0: No breaking changes\n    // 6.7.0 -> 6.8.0: Mouse support added, may need to disable by default\n    \n    if (this.compareVersions(targetVersion, \"6.8.0\") >= 0) {\n      // Enable mouse support by default in 6.8.0+\n      if (transformed.enableMouse === undefined) {\n        transformed.enableMouse = false // Opt-in for compatibility\n      }\n    }\n    \n    return transformed\n  }\n\n  /**\n   * Create an Ink component wrapper that integrates with OpenTUI\n   */\n  createComponentWrapper<P extends Record<string, unknown>>(\n    InkComponent: React.ComponentType<P>,\n    bridge: CLITerminalBridge\n  ): React.ComponentType<P> {\n    // This would wrap the Ink component with OpenTUI integration\n    // In a full implementation, this would:\n    // 1. Intercept Ink's stdout/stderr\n    // 2. Route output through the terminal bridge\n    // 3. Handle input from the bridge\n    \n    return InkComponent\n  }\n}\n\n/**\n * Create an Ink adapter instance\n */\nexport function createInkAdapter(options?: InkAdapterOptions): InkAdapter {\n  return new InkAdapter(options)\n}\n\n// Export for type inference\nexport type { InkRenderInstance }\n",
      "type": "registry:ui"
    }
  ]
}